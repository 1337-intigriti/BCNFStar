<div sbbDialogTitle>Metanome configuration settings</div>
<div sbbDialogContent>
  <form class="sbb-form-group-vertical" [formGroup]="formGroup">
    <h2>Functional Dependencies</h2>
    <ul>
      <li *ngFor="let table of tables">
        <div>
          {{ table.schemaAndName() }}
        </div>
        <div>
          <ng-container
            [ngTemplateOutlet]="
              useOldMetanomeFdResult['fds_' + table.schemaAndName()]
                ? useOldMetnomeFdConfig
                : useNewMetanomeFdConfig
            "
            [ngTemplateOutletContext]="{ table: table }"
          >
          </ng-container>
        </div>
        <div>
          <button
            sbb-button
            (click)="toggleFdResult('fds_' + table.schemaAndName())"
          >
            {{
              useOldMetanomeFdResult["fds_" + table.schemaAndName()]
                ? "Use new configuration"
                : "Use old metanome result"
            }}
          </button>
        </div>
      </li>
    </ul>
    <h2>Inclusion Dependencies</h2>
    <ul>
      <li>
        <div>
          {{ getAllTableNames() }}
        </div>
        <div>
          <ng-container
            [ngTemplateOutlet]="
              useOldMetanomeIndResult
                ? useOldMetnomeIndConfig
                : useNewMetanomeIndConfig
            "
          >
          </ng-container>
        </div>
        <div>
          <button sbb-button (click)="toggleIndResult()">
            {{
              useOldMetanomeIndResult
                ? "Use new configuration"
                : "Use old metanome result"
            }}
          </button>
        </div>
      </li>
    </ul>
  </form>
</div>
<div sbbDialogActions>
  <button (click)="runMetoname()" sbb-button cdkFocusInitial>Ok</button>
  <button sbb-secondary-button sbbDialogClose>Cancel</button>
</div>

<ng-template #useOldMetnomeFdConfig let-table="table" [formGroup]="formGroup">
  <sbb-form-field>
    <sbb-select
      placeholder="Old results"
      [formControlName]="'fds_' + table.schemaAndName()"
    >
      <sbb-option
        *ngFor="let result of filteredMetanomeResultsForFd(table)"
        [value]="result"
      >
        {{ getMetanomeConfigurationInformation(result) }}
      </sbb-option>
    </sbb-select>
  </sbb-form-field>
</ng-template>

<ng-template #useNewMetanomeFdConfig let-table="table" [formGroup]="formGroup">
  <div>
    <sbb-form-field>
      <sbb-label>Algorithm</sbb-label>
      <sbb-select
        placeholder="Functional Dependency algorithm"
        [formControlName]="'fds_' + table.schemaAndName()"
        (selectionChange)="
          changeFdConfig($event.value.algorithm, 'fds_' + table.schemaAndName())
        "
      >
        <sbb-option
          [value]="
            buildNewFdConfig(
              'de.metanome.algorithms.normalize.Normi',
              'fds_' + table.schemaAndName()
            )
          "
          >{{
            buildNewFdConfig(
              "de.metanome.algorithms.normalize.Normi",
              "fds_" + table.schemaAndName()
            )
              .algorithm.split(".")
              .slice(-1)
          }}</sbb-option
        >
        <sbb-option
          [value]="
            buildNewFdConfig(
              'de.metanome.algorithms.hyfd.HyFD',
              'fds_' + table.schemaAndName()
            )
          "
          >{{
            buildNewFdConfig(
              "de.metanome.algorithms.hyfd.HyFD",
              "fds_" + table.schemaAndName()
            )
              .algorithm.split(".")
              .slice(-1)
          }}</sbb-option
        >
      </sbb-select>
      <div
        *ngFor="
          let entry of selectedFdConfigs['fds_' + table.schemaAndName()]
            | keyvalue
        "
      >
        <sbb-checkbox
          *ngIf="isBoolean(entry.value)"
          [(ngModel)]="
            selectedFdConfigs['fds_' + table.schemaAndName()][entry.key]
          "
          [ngModelOptions]="{ standalone: true }"
        >
          {{ entry.key }}
        </sbb-checkbox>
        <div *ngIf="!isBoolean(entry.value)">
          <sbb-label>{{ entry.key }}</sbb-label>
          <input
            sbbInput
            [(ngModel)]="
              selectedFdConfigs['fds_' + table.schemaAndName()][entry.key]
            "
            [ngModelOptions]="{ standalone: true }"
          />
        </div>
      </div>
    </sbb-form-field>
  </div>
</ng-template>

<ng-template #useOldMetnomeIndConfig [formGroup]="formGroup">
  <sbb-form-field>
    <sbb-select placeholder="Old results" formControlName="inds">
      <sbb-option
        *ngFor="let result of filteredMetanomeResultsForInd()"
        [value]="result"
      >
        {{ getMetanomeConfigurationInformation(result) }}
      </sbb-option>
    </sbb-select>
  </sbb-form-field>
</ng-template>

<ng-template #useNewMetanomeIndConfig [formGroup]="formGroup">
  <div>
    <sbb-form-field>
      <sbb-label>Algorithm</sbb-label>
      <sbb-select
        placeholder="Functional Dependency algorithm"
        formControlName="inds"
        (selectionChange)="changeIndConfig($event.value.algorithm)"
      >
        <sbb-option
          [value]="
            buildNewIndConfig('de.metanome.algorithms.binder.BINDERFile')
          "
        >
          {{
            buildNewIndConfig("de.metanome.algorithms.binder.BINDERFile")
              .algorithm.split(".")
              .slice(-1)
          }}
        </sbb-option>
        <sbb-option
          [value]="buildNewIndConfig('de.hpi.mpss2015n.approxind.FAIDA')"
        >
          {{
            buildNewIndConfig("de.hpi.mpss2015n.approxind.FAIDA")
              .algorithm.split(".")
              .slice(-1)
          }}
        </sbb-option>
      </sbb-select>
      <div *ngFor="let entry of selectedIndConfig | keyvalue">
        <sbb-checkbox
          *ngIf="isBoolean(entry.value)"
          [(ngModel)]="selectedIndConfig[entry.key]"
          [ngModelOptions]="{ standalone: true }"
        >
          {{ entry.key }}
        </sbb-checkbox>
        <div *ngIf="!isBoolean(entry.value)">
          <sbb-label>{{ entry.key }}</sbb-label>
          <input sbbInput [value]="selectedIndConfig[entry.key]" />
        </div>
      </div>
    </sbb-form-field>
  </div>
</ng-template>
