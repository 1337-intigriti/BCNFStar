<div sbbDialogTitle>Metanome configuration settings</div>
<div sbbDialogContent>
  <form class="sbb-form-group-vertical" [formGroup]="formGroup">
    <h2>Functional Dependencies</h2>
    <ul>
      <li *ngFor="let table of tables; let index = index">
        <div>
          {{ table.schemaAndName() }}
        </div>
        <div>
          <ng-container
            [ngTemplateOutlet]="
              useOldMetanomeFdResult[index]
                ? useOldMetnomeFdConfig
                : useNewMetanomeFdConfig
            "
            [ngTemplateOutletContext]="{ table: table }"
          >
          </ng-container>
        </div>
        <div>
          <button sbb-button (click)="toggleFdResult(index)">
            {{
              useOldMetanomeFdResult[index]
                ? "Use new configuration"
                : "Use old metanome result"
            }}
          </button>
        </div>
      </li>
    </ul>
    <h2>Inclusion Dependencies</h2>
    <ul>
      <li>
        <div>
          {{ getAllTableNames() }}
        </div>
        <div>
          <ng-container
            [ngTemplateOutlet]="
              useOldMetanomeIndResult
                ? useOldMetnomeIndConfig
                : useNewMetanomeIndConfig
            "
          >
          </ng-container>
        </div>
        <div>
          <button sbb-button (click)="toggleIndResult()">
            {{
              useOldMetanomeIndResult
                ? "Use new configuration"
                : "Use old metanome result"
            }}
          </button>
        </div>
      </li>
    </ul>
  </form>
</div>
<div sbbDialogActions>
  <button (click)="runMetoname()" sbb-button cdkFocusInitial>Ok</button>
  <button sbb-secondary-button sbbDialogClose>Cancel</button>
</div>

<ng-template #useOldMetnomeFdConfig let-table="table" [formGroup]="formGroup">
  <sbb-form-field>
    <sbb-select
      placeholder="Old results"
      [formControlName]="'fdResult_' + table.schemaAndName()"
    >
      <sbb-option
        *ngFor="let result of filteredMetanomeResultsForFd(table)"
        [value]="result"
      >
        {{ getMetanomeConfigurationInformation(result) }}
      </sbb-option>
    </sbb-select>
  </sbb-form-field>
</ng-template>

<ng-template #useNewMetanomeFdConfig let-table="table" [formGroup]="formGroup">
  <div>
    <sbb-form-field>
      <sbb-label>Algorithm</sbb-label>
      <sbb-select
        placeholder="Functional Dependency algorithm"
        [formControlName]="'fdResult_' + table.schemaAndName()"
        (selectionChange)="changeFdConfig($event)"
      >
        <sbb-option value="Normi">Normi</sbb-option>
        <sbb-option value="HyFd">HyFd</sbb-option>
      </sbb-select>
      <div
        *ngFor="
          let entry of selectedFdConfigs['fdConfig_' + table.schemaAndName()]
            | keyvalue
        "
      >
        <sbb-checkbox
          *ngIf="isBoolean(entry.value)"
          [(ngModel)]="entry.value"
          [ngModelOptions]="{ standalone: true }"
        >
          {{ entry.key }}
        </sbb-checkbox>
        <div *ngIf="!isBoolean(entry.value)">
          <sbb-label>{{ entry.key }}</sbb-label>
          <input sbbInput [value]="entry.value" />
        </div>
      </div>
    </sbb-form-field>
  </div>
</ng-template>

<ng-template #useOldMetnomeIndConfig [formGroup]="formGroup">
  <sbb-form-field>
    <sbb-select placeholder="Old results" formControlName="indResult">
      <sbb-option
        *ngFor="let result of filteredMetanomeResultsForInd()"
        [value]="result"
      >
        {{ getMetanomeConfigurationInformation(result) }}
      </sbb-option>
    </sbb-select>
  </sbb-form-field>
</ng-template>

<ng-template #useNewMetanomeIndConfig [formGroup]="formGroup">
  <div>
    <sbb-form-field>
      <sbb-label>Algorithm</sbb-label>
      <sbb-select
        placeholder="Functional Dependency algorithm"
        formControlName="indResult"
        (selectionChange)="changeIndConfig($event)"
      >
        <sbb-option value="BINDER">BINDER</sbb-option>
        <sbb-option value="FAIDA">FAIDA</sbb-option>
      </sbb-select>
      <div *ngFor="let entry of selectedIndConfig | keyvalue">
        <sbb-checkbox
          *ngIf="isBoolean(entry.value)"
          [(ngModel)]="entry.value"
          [ngModelOptions]="{ standalone: true }"
        >
          {{ entry.key }}
        </sbb-checkbox>
        <div *ngIf="!isBoolean(entry.value)">
          <sbb-label>{{ entry.key }}</sbb-label>
          <input sbbInput [value]="entry.value" />
        </div>
      </div>
    </sbb-form-field>
  </div>
</ng-template>
